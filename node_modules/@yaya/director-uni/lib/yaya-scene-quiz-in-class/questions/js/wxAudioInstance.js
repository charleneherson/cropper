import { EventEmitter } from "../../../yaya-common/event-emitter";

/**
 * 单句跟读/古诗背诵/开放口述题型 音频实例
 */
class InnerAudio extends EventEmitter {
  constructor() {
    super();
    this.innerAudioContext = wx.createInnerAudioContext();
    this.initAction();
  }
  // 更新音频资源
  updateAudioSrc (url) {
    this.innerAudioContext.autoplay = false;
    this.innerAudioContext.src = url;
    console.log(`更换音频URL ${url}`);
  }

  // 清空已注册事件并重新注册
  initAction () {
    this.destroy();

    this.innerAudioContext.onPlay(() => {
      this.emit('play')
    });
    this.innerAudioContext.onEnded(() => {
      this.emit('ended')
    });
  }

  // 播放结束事件
  onPlay (handler) {
    this.on("play", handler);
  }

  // 播放结束事件
  onEnded (handler) {
    this.on("ended", handler);
  }

  // 开始播放音频
  playAudio () {
    console.log(`播放音频 ${this.innerAudioContext.src}`);
    this.innerAudioContext.play();
  }
}

export default new InnerAudio()
