<template>
  <view class="interception-page">
    <view class="bg_left">
      <view
        v-if="msgType != 'leave'"
        class="cancel-btn"
        @click="onCancel"
      ></view>
    </view>
    <view class="bg_right"></view>
    <view
      class="container"
      v-if="['allFinishNoReport', 'allFinish'].includes(msgType)"
    >
      <view class="box is_play"></view>
    </view>
    <view v-if="msgType === 'leave'" class="msg leave-msg">
      <image
        class="yaya-image"
        src="https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/interception-yaya-middle.png"
      ></image>
      <view>你还没有完成该环节的学习哦，</view>
      <view>确认离开？</view>
    </view>
    <view
      id="i-leave-page"
      v-if="msgType === 'leave'"
      class="leave-btn-group btn-group"
    >
      <view id="i-leave-btn" class="confirm-leave-btn btn" @click="onBack"
        >确认离开</view
      >
      <view
        id="i-continue-btn"
        class="continue-learn-btn btn overstriking btn-primary"
        @click="onContinue"
        >继续学习</view
      >
    </view>
    <view v-if="msgType === 'finish'" class="msg next-msg">
      <view class="countdown">
        {{ countdown }}
        <view class="second">s</view>
      </view>
      <view>后进入下一个环节</view>
    </view>
    <view
      id="i-next-page"
      v-if="msgType === 'finish'"
      class="next-btn-group btn-group"
    >
      <view id="i-replay-btn" class="btn icon-replay" @click="onAgain"
        >再学一次</view
      >
      <view id="i-next-btn" class="btn btn-primary icon-next" @click="onNext"
        >下一环节</view
      >
      <!-- <view class="btn btn-primary">查看报告</view> -->
    </view>
    <view
      id="i-next-page"
      v-if="['allFinishNoReport', 'allFinish'].includes(msgType)"
      class="next-btn-group btn-group"
    >
      <view class="has_finish">已完成学习</view>
      <view id="i-replay-btn" class="btn icon-replay" @click="onAgain"
        >再学一次</view
      >
      <view
        v-if="msgType === 'allFinish'"
        id="i-next-btn"
        class="btn btn-primary icon-next"
        @click="onNext"
        >查看报告</view
      >
      <view
        v-if="msgType === 'allFinishNoReport'"
        id="i-next-btn"
        class="btn btn-primary icon-next"
        @click="onNext"
        >我的课程</view
      >
      <!-- <view class="btn btn-primary">查看报告</view> -->
    </view>
  </view>
</template>

<script>
const InterceptionType = {
  None: "",
  Leave: "leave",
  Finish: "finish",
};
export default {
  name: "yaya-interception-page",
  data() {
    return {
      countdown: 3,
      countdownTimer: null,
      innerAudioContext: null,
    };
  },
  components: {},
  props: {
    msgType: {
      type: String,
      default: "finish",
    },
  },
  mounted() {
    console.log("this.msgTypethis.msgType", this.msgType);
    if (this.msgType === "allFinish") {
      console.log("allFinish");
      this.innerAudioContext = wx.createInnerAudioContext();
      this.innerAudioContext.src =
        "https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/audio/congratulations-complete.mp3";
      this.innerAudioContext.play();
    }
    if (this.msgType === "finish") {
      this.startCountdown();
    }
  },
  watch: {
    msgType(val) {
      console.log("msgTypemsgTypemsgTypemsgTypemsgTypemsgType", val);
      if (val === "finish") {
        this.startCountdown();
      }
    },
  },
  methods: {
    startCountdown() {
      clearInterval(this.countdownTimer);
      this.countdownTimer = setInterval(() => {
        this.countdown--;
        if (this.countdown === 0) {
          clearInterval(this.countdownTimer);
          this.$emit("next");
        }
      }, 1000);
    },
    stopCountdown() {
      if (this.countdownTimer) {
        clearInterval(this.countdownTimer);
        this.countdown = 3;
      }
    },
    onBack(e) {
      this.stopCountdown();
      this.$emit("back", e);
    },
    onAgain(e) {
      this.stopCountdown();
      this.$emit("again", e);
    },
    onContinue(e) {
      this.stopCountdown();
      this.$emit("continue", e);
    },
    onNext(e) {
      this.countdownTimer && clearInterval(this.countdownTimer);
      this.$emit("next", e);
    },
    onCancel(e) {
      this.$emit("cancel", e);
    },
  },
};
</script>

<style scoped lang="scss">
@import "../static/css/yaya-mixin.scss";
.interception-page {
  width: 100vw;
  height: 100vh;
  background: #fff7f0;
  position: relative;
  z-index: 100;
  padding-top: 0.01rpx;
  .bg_left {
    @include w_h(626, 123);
    height: 100vh;
    position: absolute;
    left: 0;
    bottom: 0;
    background: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/bg-left-2x.png")
      0 0 no-repeat;
    background-size: cover;
    .cancel-btn {
      position: absolute;
      top: tovmin(33);
      left: tovmin(33);
      background-image: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/interception-cancel.png");
      background-size: tovmin(67) tovmin(67);
      background-repeat: no-repeat;
      width: tovmin(67);
      height: tovmin(67);
      z-index: 5;
    }
  }
  .bg_right {
    @include w_h(490, 155);
    height: 100vh;
    position: absolute;
    right: 0;
    bottom: 0;
    background: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/bg-right-2x.png")
      0 0 no-repeat;
    background-size: cover;
  }
  // .duck {
  //   @include w_h(118, 197);
  //   position: absolute;
  //   top: tovmin(92);
  //   left: 50%;
  //   transform: translate3d(-50%, 0, 0);
  //   border: 1px solid red;
  // }
  .container {
    width: tovmin(800);
    height: tovmin(450);
    overflow: hidden;
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    z-index: 4;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .box {
    width: tovmin(286);
    height: tovmin(282);
    background-image: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/yaya-fight.gif");
    background-size: cover;
  }
  @keyframes yayaAnimation {
    0% {
      background-position-x: 0%;
    }
    100% {
      background-position-x: -7600%;
    }
  }
  .msg {
    @include w_h(514, 116);
    font-size: tovmin(36);
    line-height: tovmin(56);
    font-weight: 400;
    color: rgba(51, 51, 51, 1);
    position: absolute;
    top: tovmin(75);
    left: 50%;
    transform: translate3d(-50%, 0, 0);
    &.next-msg {
      // margin-top: tovmin()
      top: tovmin(192);
      .countdown {
        color: rgba(255, 106, 106, 1);
        font-size: tovmin(64);
        line-height: tovmin(90);
        font-weight: 700;
        .second {
          font-size: tovmin(36);
          display: inline-block;
        }
      }
    }
  }
  .leave-msg {
    font-size: tovmin(36);
    .yaya-image {
      width: tovmin(282);
      height: tovmin(282);
      margin: 0 auto;
      margin-bottom: tovmin(38);
    }
  }
  .btn-group {
    width: tovmin(630);
    position: absolute;
    bottom: tovmin(162);
    left: 50%;
    transform: translate3d(-50%, 0, 0);
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    z-index: 5;
    .has_finish {
      @include f_c(36, #333333);
      position: absolute;
      top: tovmin(-96);
      left: 50%;
      transform: translate3d(-50%, 0, 0);
    }
    .confirm-leave-btn {
      background-image: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/interception-back.png");
    }
    .continue-learn-btn {
      background-image: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/interception-continue.png");
    }
    .btn {
      position: relative;
      @include w_h(280, 88);
      border-radius: tovmin(44);
      border: tovmin(2) solid rgba(255, 106, 106, 1);
      color: rgba(255, 106, 106, 1);
      font-size: tovmin(32);
      line-height: tovmin(88);
      font-weight: 500;
      text-indent: tovmin(35);
      box-sizing: border-box;
      &.overstriking {
        font-weight: bold;
      }
      &.btn-primary {
        color: rgba(255, 255, 255, 1);
        background-color: rgba(255, 106, 106, 1);
      }
      background-size: tovmin(27) tovmin(28);
      background-repeat: no-repeat;
      background-position: tovmin(38) center;
      &.icon-replay {
        background-image: url("./static/replay-btn-2x.png");
      }
      &.icon-next {
        background-image: url("./static/next-btn-2x.png");
      }
    }
  }
  .leave-btn-group {
    bottom: tovmin(97);
  }
}
</style>
