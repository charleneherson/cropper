<template>
  <view v-if="isShowAwardResult" class="mask" id="accounts_gold_coins">
    <view class="bg_left"></view>
    <view class="bg_right"></view>
    <view class="flower_down"></view>
    <view class="result-container">
      <view class="gold_cup"></view>
      <view class="container">
        <view class="animation" @animationend="animationResult"></view>
        <view class="header"></view>
        <view class="content">
          <view class="plus"></view>
          <view class="number">
            <view class="number-box">
              <view
                class="number-item"
                v-for="(item, index) of coinsArr"
                :key="index"
                >{{ item > 9 ? "" : "0" }}{{ item }}</view
              >
            </view>
          </view>
        </view>
        <view class="text"
          >本次最多连续答对<span class="totalCount">{{ totalCount }}</span
          >题!</view
        >
      </view>
    </view>
  </view>
</template>

<script>
import { mapState, mapMutations } from "vuex";
export default {
  data() {
    this.iAudioContext = uni.createInnerAudioContext();
    return {
      showNumber: 0,
      totalCount: 0,
      totalCoins: 0,
      timer: null,
      coinsArr: [],
    };
  },
  props: {
    isShowAwardResult: {
      type: Boolean,
      default: false,
    },
  },
  computed: {
    ...mapState("yayaCommon", ["gold_count", "AWARD_EXT"]),
  },
  created() {
    //注：这有个大坑，mounted中挂载会在IOS会不进行,安卓可以，created,iOS可以
    this.totalCoins = this.AWARD_EXT.module_reward;
    // this.totalCoins = 50;
    //处理老虎机
    for (let index = 0; index < this.totalCoins + 1; index++) {
      this.coinsArr.push(index);
    }
  },
  mounted() {
    this.totalCoins = this.AWARD_EXT.module_reward;
    this.totalCount = this.AWARD_EXT.max_correct;
    let t = 3070 / this.totalCoins;
    const audioSrc =
      "https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/fankui/finish_coins_new.mp3";
    let fileCache = uni.getStorageSync("mask_mp3", fileCache);
    this.iAudioContext.src = fileCache[audioSrc]
      ? fileCache[audioSrc]
      : audioSrc;
    this.iAudioContext.play();
    this.timer = setInterval(() => {
      this.showNumber++;
      if (this.showNumber >= this.totalCoins) {
        clearInterval(this.timer);
      }
    }, t);
  },
  methods: {
    animationResult() {
      this.$emit("animationResult");
    },
  },
};
</script>

<style lang="scss" scoped>
@import "../../../static/css/yaya-mixin.scss";
.mask {
  background: #ffb657;
  width: 100vw;
  height: 100vh;
  position: fixed;
  left: 0;
  bottom: 0;
  z-index: 100;
  .bg_left {
    height: 100vh;
    width: tovmin(530);
    position: absolute;
    left: 0;
    bottom: 0;
    background: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/fankui/gold_bg_left.png")
      0 0 no-repeat;
    background-size: cover;
  }
  .bg_right {
    height: 100vh;
    width: tovmin(530);
    position: absolute;
    right: 0;
    bottom: 0;
    background: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/fankui/gold_bg_right.png")
      0 0 no-repeat;
    background-size: cover;
  }
}
.flower_down {
  width: 100vw;
  height: 100vh;
  background: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/animation/sx.gif")
    no-repeat 100% 100%;
  background-size: cover;
  position: absolute;
}
.container {
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 1);
  border-radius: tovmin(48);
  position: relative;
  animation: scale_big 0.7s steps(1) 1;
}
.plus {
  width: tovmin(20);
  height: tovmin(20);
  background: url("./+.png");
  background-size: cover;
  position: absolute;
  left: tovmin(195);
  top: tovmin(86);
}
.header {
  width: tovmin(476);
  height: tovmin(188);
  background-image: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/fankui/leiji.png");
  background-size: tovmin(1904) tovmin(564);
  position: absolute;
  top: -7%;
  left: 50%;
  transform: translateX(-50%);
  animation: header_scale 0.7s steps(1) 1;
}
.result-container {
  position: fixed;
  left: 50%;
  top: tovmin(211);
  width: tovmin(520);
  height: tovmin(389);
  transform: translateX(-50%);
  .gold_cup {
    position: absolute;
    @include w_h(167, 143);
    @include position_center();
    top: tovmin(-67.5);
    background-image: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/fankui/gold_cup.png");
    background-size: cover;
    animation: scale_big_cup 0.7s steps(1) 1;
  }
}
.content {
  width: tovmin(440);
  height: tovmin(190);
  background: #fbe6da;
  border: tovmin(4) solid rgba(253, 234, 224, 1);
  box-shadow: 0px 0px tovmin(87) 0px rgba(251, 230, 218, 0.89);
  border-radius: tovmin(20);
  position: absolute;
  top: tovmin(109);
  left: tovmin(40);
  overflow: hidden;
}
.text {
  width: tovmin(300);
  height: tovmin(27);
  font-size: tovmin(28);
  font-family: PingFang SC;
  font-weight: 400;
  color: rgba(102, 102, 102, 1);
  position: absolute;
  top: tovmin(320);
  left: tovmin(112);
  span {
    color: #ff6a6a;
    display: inline-block;
    margin: 0 tovmin(6);
  }
}
.number {
  padding: tovmin(10);
  width: tovmin(220);
  height: tovmin(85);
  font-size: tovmin(104);
  font-family: DIN Alternate;
  font-weight: bold;
  color: rgba(255, 106, 106, 1);
  position: absolute;
  top: tovmin(45);
  left: tovmin(220);
  text-align: left;
  line-height: tovmin(80);
  // overflow: hidden;
  // animation: number_hidden 0.5s linear 1;
  // animation-delay: 2.57s;
  // animation-fill-mode: forwards;

  .number-box {
    animation: number_move 2.57s linear 1;
    // -webkit-transition: -webkit-transform;
    animation-fill-mode: forwards;
    margin-top: tovmin(78);
    .number-item {
      margin-bottom: tovmin(60);
      font-family: DIN Alternate;
      &:last-child {
        animation: number_big 0.5s linear 1;
        animation-delay: 2.67s;
        margin-bottom: tovmin(0);
      }
    }
  }
}
.animation {
  width: tovmin(479);
  height: tovmin(505);
  background-image: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/animation/jingbi.png");
  animation: animation1 3.07s steps(1) 1;
  position: absolute;
  top: tovmin(13);
  left: tovmin(-100);
  background-size: tovmin(1916) tovmin(6060);
  z-index: 1000;
}
@keyframes animation1 {
  0% {
    background-position: tovmin(0) tovmin(0);
  }
  2.17% {
    background-position: tovmin(-479) tovmin(0);
  }
  4.35% {
    background-position: tovmin(-958) tovmin(0);
  }
  6.52% {
    background-position: tovmin(-1437) tovmin(0);
  }
  8.70% {
    background-position: tovmin(0) tovmin(-505);
  }
  10.87% {
    background-position: tovmin(-479) tovmin(-505);
  }
  13.04% {
    background-position: tovmin(-958) tovmin(-505);
  }
  15.22% {
    background-position: tovmin(-1437) tovmin(-505);
  }
  17.39% {
    background-position: tovmin(0) tovmin(-1010);
  }
  19.57% {
    background-position: tovmin(-479) tovmin(-1010);
  }
  21.74% {
    background-position: tovmin(-958) tovmin(-1010);
  }
  23.91% {
    background-position: tovmin(-1437) tovmin(-1010);
  }
  26.09% {
    background-position: tovmin(0) tovmin(-1515);
  }
  28.26% {
    background-position: tovmin(-479) tovmin(-1515);
  }
  30.43% {
    background-position: tovmin(-958) tovmin(-1515);
  }
  32.61% {
    background-position: tovmin(-1437) tovmin(-1515);
  }
  34.78% {
    background-position: tovmin(0) tovmin(-2020);
  }
  36.96% {
    background-position: tovmin(-479) tovmin(-2020);
  }
  39.13% {
    background-position: tovmin(-958) tovmin(-2020);
  }
  41.30% {
    background-position: tovmin(-1437) tovmin(-2020);
  }
  43.48% {
    background-position: tovmin(0) tovmin(-2525);
  }
  45.65% {
    background-position: tovmin(-479) tovmin(-2525);
  }
  47.83% {
    background-position: tovmin(-958) tovmin(-2525);
  }
  50.00% {
    background-position: tovmin(-1437) tovmin(-2525);
  }
  52.17% {
    background-position: tovmin(0) tovmin(-3030);
  }
  54.35% {
    background-position: tovmin(-479) tovmin(-3030);
  }
  56.52% {
    background-position: tovmin(-958) tovmin(-3030);
  }
  58.70% {
    background-position: tovmin(-1437) tovmin(-3030);
  }
  60.87% {
    background-position: tovmin(0) tovmin(-3535);
  }
  63.04% {
    background-position: tovmin(-479) tovmin(-3535);
  }
  65.22% {
    background-position: tovmin(-958) tovmin(-3535);
  }
  67.39% {
    background-position: tovmin(-1437) tovmin(-3535);
  }
  69.57% {
    background-position: tovmin(0) tovmin(-4040);
  }
  71.74% {
    background-position: tovmin(-479) tovmin(-4040);
  }
  73.91% {
    background-position: tovmin(-958) tovmin(-4040);
  }
  76.09% {
    background-position: tovmin(-1437) tovmin(-4040);
  }
  78.26% {
    background-position: tovmin(0) tovmin(-4545);
  }
  80.43% {
    background-position: tovmin(-479) tovmin(-4545);
  }
  82.61% {
    background-position: tovmin(-958) tovmin(-4545);
  }
  84.78% {
    background-position: tovmin(-1437) tovmin(-4545);
  }
  86.96% {
    background-position: tovmin(0) tovmin(-5050);
  }
  89.13% {
    background-position: tovmin(-479) tovmin(-5050);
  }
  91.30% {
    background-position: tovmin(-958) tovmin(-5050);
  }
  93.48% {
    background-position: tovmin(-1437) tovmin(-5050);
  }
  95.65% {
    background-position: tovmin(0) tovmin(-5555);
  }
  97.83% {
    background-position: tovmin(-479) tovmin(-5555);
  }
  100.00% {
    background-position: tovmin(-958) tovmin(-5555);
  }
}
@keyframes scale_big {
  0% {
    transform: scale(0, 0);
  }
  50% {
    transform: scale(0.5, 0.5);
  }
  55% {
    transform: scale(0.55, 0.55);
  }
  60% {
    transform: scale(0.6, 0.6);
  }
  65% {
    transform: scale(0.65, 0.65);
  }
  70% {
    transform: scale(0.7, 0.7);
  }
  75% {
    transform: scale(0.75, 0.75);
  }
  80% {
    transform: scale(0.8, 0.8);
  }
  85% {
    transform: scale(0.85, 0.85);
  }
  90% {
    transform: scale(0.9, 0.9);
  }
  95% {
    transform: scale(0.95, 0.95);
  }
  100% {
    transform: scale(1, 1);
  }
}
@keyframes scale_big_cup {
  0% {
    opacity: 0;
  }

  100% {
    opacity: 1;
  }
}
@keyframes header_scale {
  0% {
    background-position: 0px 0px;
  }
  10.00% {
    background-position: tovmin(-476) 0px;
  }
  20.00% {
    background-position: tovmin(-952) 0px;
  }
  30.00% {
    background-position: tovmin(-1428) 0px;
  }
  40.00% {
    background-position: 0px tovmin(-188);
  }
  50.00% {
    background-position: tovmin(-476) tovmin(-188);
  }
  60.00% {
    background-position: tovmin(-952) tovmin(-188);
  }
  70.00% {
    background-position: tovmin(-1428) tovmin(-188);
  }
  80.00% {
    background-position: 0px tovmin(-376);
  }
  90.00% {
    background-position: tovmin(-476) tovmin(-376);
  }
  100.00% {
    background-position: tovmin(-952) tovmin(-376);
  }
}
@keyframes number_move {
  0% {
    transform: translateY(-0%);
  }
  50% {
    transform: translateY(-50%);
  }
  100% {
    transform: translateY(-100%);
  }
}
@keyframes number_big {
  0% {
    transform: scale(1, 1);
  }
  50% {
    transform: scale(1.08, 1.08);
  }
  100% {
    transform: scale(1, 1);
  }
}
@keyframes number_hidden {
  0% {
    overflow: auto;
  }
  100% {
    overflow: hidden;
  }
}
</style>
