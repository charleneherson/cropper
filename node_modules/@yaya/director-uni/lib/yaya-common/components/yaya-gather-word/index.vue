<template>
  <view v-if="isShowGatherWord" class="mask" id="yaya-common-word-card">
    <view class="bg_left"></view>
    <view class="bg_right"></view>
    <view class="gather-container" v-if="!selfFirstGather">
      <!-- 这个地方为了能多次调用动画，尝试循环渲染整体部分效果不佳，暂只能使用布局多次进处理， -->
      <view class="gather-card-container-0" v-if="firstShow">
        <!-- 骚操作判断样式，屡试不爽 -->
        <view
          v-if="commonList.length > 0"
          class="gather-card-content"
          :class="
            commonList.length > 11
              ? 'line-12'
              : commonList.length < 11 && commonList.length > 6
              ? 'line-5'
              : commonList.length === 6
              ? 'line-6'
              : commonList.length < 6
              ? 'line-min'
              : ''
          "
        >
          <view
            class="gather-card-item"
            v-for="(ite, idx) of commonList"
            :key="idx"
          >
            {{ ite }}
          </view>
        </view>
      </view>
      <view class="gather-card-container-1" v-if="secondShow">
        <view
          v-if="commonList.length > 0"
          class="gather-card-content"
          :class="
            commonList.length > 11
              ? 'line-12'
              : commonList.length < 11 && commonList.length > 6
              ? 'line-5'
              : commonList.length === 6
              ? 'line-6'
              : commonList.length < 6
              ? 'line-min'
              : ''
          "
        >
          <view
            class="gather-card-item"
            v-for="(ite, idx) of commonList"
            :key="idx"
          >
            {{ ite }}
          </view>
        </view>
      </view>
      <view class="gather-box-container" v-if="showBox">
        <view class="open-box" v-if="showOpen"> </view>
        <view class="box-cover" v-if="showOpening"> </view>
        <view class="crad-right" v-if="showOpening">
          <img
            src="https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-word-card/bg-rihght.png"
            alt=""
          />
        </view>
        <view class="box-bg" v-if="showOpening"> </view>
        <view class="opening-box" v-if="showOpening"> </view>
        <view class="close-box" v-if="showClose"> </view>
      </view>
    </view>
    <view class="first-gather" v-if="selfFirstGather">
      <view class="gather-yaya">
        <view class="bg-image"> </view>
        <!-- <img
          src="https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-word-card/yaya-guid.gif"
          alt=""
        /> -->
      </view>
      <view class="gather-guide">
        <view class="guide-bar">
          <img
            src="https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-word-card/word-bar.svg"
            alt=""
          />
        </view>
      </view>
    </view>
  </view>
</template>

<script>
import { mapState, mapMutations } from "vuex";
export default {
  name: "YayaGatherWord",
  data() {
    return {
      commonLists: [[], [], [], [], [], []],
      commonList: [],
      firstShow: true,
      secondShow: false,
      showOpen: false,
      showClose: false,
      showOpening: false,
      showBox: false,
      firstGather: false, //首次
      selfFirstGather: false,
      innerAudioContext: null,
      innerAudioContextFirst: null,
    };
  },
  props: {
    isShowGatherWord: {
      type: Boolean,
      default: false,
    },
    common: {
      type: Array,
      default: [],
    },
  },
  computed: {},
  created() {
    if (!wx.getStorageSync("fisrtGatherWord")) {
      this.firstGather = true;
      wx.setStorageSync("fisrtGatherWord", true);
    }
    console.log("createdcreatedcreatedcreated", this.common);
    let vals = [
      "一",
      "二",
      "三",
      "四",
      "五",
      "六",
      "七",
      "八",
      "九",
      "十",
      // "五",
      // "五",
      // "一",
      // "二",
      // "三",
      // "四",
      // "五",
      // "六",
    ];
    vals = this.common;

    if (vals.length < 13) {
      console.log("11111111111111111");
      //播放 音频
      this.innerAudioContext = wx.createInnerAudioContext();
      this.innerAudioContext.src =
        "https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-word-card/common-gather.mp3";
      setTimeout(() => {
        this.innerAudioContext.play();
      }, 600);
      this.handleCommonList(vals, 0);
      this.handleEndTimer(false);
    } else {
      console.log("1122222222222222222222");
      //播放 音频
      this.innerAudioContext = wx.createInnerAudioContext();
      this.innerAudioContext.src =
        "https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-word-card/common-gather-more.mp3";
      setTimeout(() => {
        this.innerAudioContext.play();
      }, 100);

      vals.forEach((element, index) => {
        let ite = Math.floor(index / 12);
        this.commonLists[ite].push(element);
      });
      this.commonLists.forEach((ele, idx) => {
        if (ele.length > 1) {
          this.handleCommonList(ele, idx);
        }
      });
    }
  },
  methods: {
    handleCommonList(item, index) {
      console.log(item, index);
      setTimeout(() => {
        this.showBox = true;
        this.showOpen = true;
      }, 900);

      if (index === 0) {
        this.commonList = item;
        setTimeout(() => {
          this.showOpening = true;
          this.showOpen = false;
        }, 1300);
      } else {
        setTimeout(() => {
          this.commonList = item;
          this.firstShow = false;
          this.secondShow = true;
          this.handleEndTimer(true);
        }, 3100);
      }
    },
    handleEndTimer(isMore) {
      let time = isMore ? 1500 : 2900;
      setTimeout(() => {
        if (isMore) {
          this.secondShow = false;
        } else {
          this.firstShow = false;
        }
        this.showOpening = false;
        this.showOpen = false;
        this.showClose = true;
        setTimeout(() => {
          this.gatherFinish();
        }, 1300);
      }, time);
    },
    gatherFinish() {
      if (this.firstGather) {
        this.selfFirstGather = true;
        this.innerAudioContextFirst = wx.createInnerAudioContext();
        this.innerAudioContextFirst.src =
          "https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-word-card/first-gather.mp3";
        this.innerAudioContextFirst.play();
        setTimeout(() => {
          this.$emit("gatherWordResult");
        }, 3000);
      } else {
        this.$emit("gatherWordResult");
      }
    },
  },
};
</script>

<style lang="scss" scoped>
@import "../../../static/css/yaya-mixin.scss";
.mask {
  background: #ffb657;
  width: 100vw;
  height: 100vh;
  position: fixed;
  left: 0;
  bottom: 0;
  z-index: 100;
  .bg_left {
    height: 100vh;
    width: tovmin(530);
    position: absolute;
    left: 0;
    bottom: 0;
    background: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/fankui/gold_bg_left.png")
      0 0 no-repeat;
    background-size: cover;
  }
  .bg_right {
    height: 100vh;
    width: tovmin(530);
    position: absolute;
    right: 0;
    bottom: 0;
    background: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/fankui/gold_bg_right.png")
      0 0 no-repeat;
    background-size: cover;
  }
}
.gather-container {
  width: 100vw;
  height: 100vh;
  position: relative;
  .gather-card-container-0,
  .gather-card-container-1 {
    padding: tovmin(60) 0 0 0;
    height: 65vh;
    display: flex;
    justify-content: center;
    .gather-card-content {
      width: tovmin(1150);
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      padding: 0 tovmin(-15);
      animation: card-box-animation 2.25s linear 1;
      animation-fill-mode: forwards;
      margin-top: tovmin(95);
      z-index: 110;
      .gather-card-item {
        // position: absolute;
        display: flex;
        justify-content: center;
        align-items: center;
        width: tovmin(160);
        font-family: KaiTiFont;
        font-size: tovmin(120);
        height: tovmin(200);
        background-image: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-word-card/bg-common.png");
        background-size: cover;
        margin: 0 tovmin(15);
        margin-bottom: tovmin(20);
        z-index: 101;
        animation: card-animation 0.9s linear 1;
        animation-fill-mode: forwards;
      }
      &.line-12 {
        width: tovmin(1150);
      }
      &.line-5 {
        width: tovmin(980);
      }
      &.line-6 {
        width: tovmin(1150);
        align-items: center;
      }
      &.line-min {
        width: tovmin(1250);
        align-items: center;
        .gather-card-item {
          width: tovmin(200);
          height: tovmin(250);
          padding: 0 tovmin(-25);
          margin: 0 tovmin(25);
        }
      }
    }
  }
  .gather-card-container-1 {
    .gather-card-content {
      margin-top: 0;
      animation: card-box-animation-1 1.65s linear 1;
      animation-fill-mode: forwards;
    }
  }
  .gather-box-container {
    position: absolute;
    width: 100vw;
    height: tovmin(338);
    bottom: 0;
    display: flex;
    justify-content: center;
    .crad-right {
      position: absolute;
      height: tovmin(538);
      width: tovmin(538);
      z-index: 100;
      img {
        width: 100%;
        height: 100%;
        animation: right-rotate 9s linear infinite;
      }
    }
    .box-cover {
      width: tovmin(421);
      height: tovmin(338);
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      background-image: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-word-card/box-half.png");
      background-size: cover;
      z-index: 120;
    }
    .box-bg {
      width: tovmin(421);
      height: tovmin(338);
      position: absolute;
      bottom: 0;
      z-index: 111;
      left: 50%;
      transform: translateX(-50%);
      background-image: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-word-card/common-star.png");
      background-size: cover;
      animation: box-bg-animation 0.9s steps(27) infinite;
    }
    .open-box {
      background-image: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-word-card/common-open-frame.png");
      background-size: tovmin(1684) tovmin(2366);
      height: tovmin(338);
      width: tovmin(421);
      animation: box-open-animation 0.83s steps(1) 1;
      animation-delay: 0.15s;
    }
    .close-box {
      background-image: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-word-card/common-close-frame.png");
      background-size: tovmin(1684) tovmin(2704);
      height: tovmin(338);
      width: tovmin(421);
      animation: box-close-animation 1s steps(1) 1;
      animation-fill-mode: forwards;
    }
    .opening-box {
      height: tovmin(338);
      width: tovmin(421);
      background-image: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-word-card/common-box-open.png");
      background-size: cover;
      z-index: 100;
    }
  }
}
.first-gather {
  display: flex;
  justify-content: center;
  align-items: flex-end;
  width: 100%;
  height: 100%;
  .gather-yaya {
    animation: gather-yaya-animation 0.6s linear 1;
    animation-fill-mode: forwards;
    margin-right: tovmin(83);
    margin-bottom: tovmin(34);
    z-index: 111;
    .bg-image {
      background-image: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-word-card/yaya-guide.png");
      background-size: tovmin(1960) tovmin(1080);
      width: tovmin(280);
      height: tovmin(360);
      animation: gather-yaya-flag 1s steps(1) infinite;
      animation-delay: 0.5s;
    }
  }
  .gather-guide {
    width: tovmin(445);
    height: tovmin(666);
    position: relative;
    margin-left: tovmin(100);
    animation: gather-guide-animation 0.6s linear 1;
    animation-fill-mode: forwards;
    background-image: url("https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-word-card/word-page.svg");
    background-size: cover;
    .guide-bar {
      width: tovmin(558);
      height: tovmin(160);
      position: absolute;
      top: tovmin(405);
      left: tovmin(-44);
      visibility: hidden;
      animation: gather-bar-animation 0.3s cubic-bezier(0.33, 0, 0, 1) 1;
      animation-delay: 0.5s;
      animation-fill-mode: forwards;
      img {
        width: 100%;
        height: 100%;
      }
    }
  }
}
@keyframes card-animation {
  0% {
    transform: scale(0.1, 0.1);
  }
  33% {
    transform: scale(1, 1);
  }
  //弹性
  44% {
    transform: scale(1, 1);
  }
  100% {
    transform: scale(1, 1);
  }
}
@keyframes card-box-animation {
  0% {
    visibility: visible;
  }
  35% {
    margin-top: tovmin(95);
  }
  37% {
    margin-top: 0;
  }
  80% {
    margin-top: 0;
    transform: scale(1, 1);
  }
  81% {
    margin-top: tovmin(-5);
    visibility: visible;
  }
  88% {
    transform-origin: center bottom;
    transform: scale(0.2, 0.2) translateY(tovmin(260));
  }
  95% {
    visibility: hidden;
    transform-origin: center bottom;
    transform: scale(0.1, 0.1) translateY(tovmin(860));
  }
  100% {
    visibility: hidden;
    transform-origin: center bottom;
    transform: scale(0.1, 0.1) translateY(tovmin(860));
  }
}
@keyframes card-box-animation-1 {
  0% {
    visibility: visible;
  }
  80% {
    margin-top: 0;
    transform: scale(1, 1);
  }
  81% {
    visibility: visible;
  }
  88% {
    transform-origin: center bottom;
    transform: scale(0.2, 0.2) translateY(tovmin(260));
  }
  95% {
    visibility: hidden;
    transform-origin: center bottom;
    transform: scale(0.1, 0.1) translateY(tovmin(1060));
  }
  100% {
    visibility: hidden;
    transform-origin: center bottom;
    transform: scale(0.1, 0.1) translateY(tovmin(1060));
  }
}
@keyframes box-open-animation {
  0% {
    background-position: tovmin(0) tovmin(0);
  }
  4.17% {
    background-position: tovmin(-421) tovmin(0);
  }
  8.33% {
    background-position: tovmin(-842) tovmin(0);
  }
  12.50% {
    background-position: tovmin(-1263) tovmin(0);
  }
  16.67% {
    background-position: tovmin(0) tovmin(-338);
  }
  20.83% {
    background-position: tovmin(-421) tovmin(-338);
  }
  25.00% {
    background-position: tovmin(-842) tovmin(-338);
  }
  29.17% {
    background-position: tovmin(-1263) tovmin(-338);
  }
  33.33% {
    background-position: tovmin(0) tovmin(-676);
  }
  37.50% {
    background-position: tovmin(-421) tovmin(-676);
  }
  41.67% {
    background-position: tovmin(-842) -tovmin(-676);
  }
  45.83% {
    background-position: tovmin(-1263) tovmin(-676);
  }
  50.00% {
    background-position: tovmin(0) tovmin(-1014);
  }
  54.17% {
    background-position: tovmin(-421) tovmin(-1014);
  }
  58.33% {
    background-position: tovmin(-842) tovmin(-1014);
  }
  62.50% {
    background-position: tovmin(-1263) tovmin(-1014);
  }
  66.67% {
    background-position: tovmin(0) tovmin(-1352);
  }
  70.83% {
    background-position: tovmin(-421) tovmin(-1352);
  }
  75.00% {
    background-position: tovmin(-842) tovmin(-1352);
  }
  79.17% {
    background-position: tovmin(-1263) tovmin(-1352);
  }
  83.33% {
    background-position: tovmin(0) tovmin(-1690);
  }
  87.50% {
    background-position: tovmin(-421) tovmin(-1690);
  }
  91.67% {
    background-position: tovmin(-842) tovmin(-1690);
  }
  95.83% {
    background-position: tovmin(-1263) tovmin(-1690);
  }
  100.00% {
    background-position: tovmin(0) tovmin(-2028);
  }
}
@keyframes box-close-animation {
  0% {
    background-position: tovmin(0) tovmin(0);
  }
  3.45% {
    background-position: tovmin(-421) tovmin(0);
  }
  6.90% {
    background-position: tovmin(-842) tovmin(0);
  }
  10.34% {
    background-position: tovmin(-1263) tovmin(0);
  }
  13.79% {
    background-position: tovmin(0) tovmin(-338);
  }
  17.24% {
    background-position: tovmin(-421) tovmin(-338);
  }
  20.69% {
    background-position: tovmin(-842) tovmin(-338);
  }
  24.14% {
    background-position: tovmin(-1263) tovmin(-338);
  }
  27.59% {
    background-position: tovmin(0) tovmin(-676);
  }
  31.03% {
    background-position: tovmin(-421) tovmin(-676);
  }
  34.48% {
    background-position: tovmin(-842) tovmin(-676);
  }
  37.93% {
    background-position: tovmin(-1263) tovmin(-676);
  }
  41.38% {
    background-position: tovmin(0) tovmin(-1014);
  }
  44.83% {
    background-position: tovmin(-421) tovmin(-1014);
  }
  48.28% {
    background-position: tovmin(-842) tovmin(-1014);
  }
  51.72% {
    background-position: tovmin(-1263) tovmin(-1014);
  }
  55.17% {
    background-position: tovmin(0) tovmin(-1352);
  }
  58.62% {
    background-position: tovmin(-421) tovmin(-1352);
  }
  62.07% {
    background-position: tovmin(-842) tovmin(-1352);
  }
  65.52% {
    background-position: tovmin(-1263) tovmin(-1352);
  }
  68.97% {
    background-position: tovmin(0) tovmin(-1690);
  }
  72.41% {
    background-position: tovmin(-421) tovmin(-1690);
  }
  75.86% {
    background-position: tovmin(-842) tovmin(-1690);
  }
  79.31% {
    background-position: tovmin(-1263) tovmin(-1690);
  }
  82.76% {
    background-position: tovmin(0) tovmin(-2028);
  }
  86.21% {
    background-position: tovmin(-421) tovmin(-2028);
  }
  89.66% {
    background-position: tovmin(-842) tovmin(-2028);
  }
  93.10% {
    background-position: tovmin(-1263) tovmin(-2028);
  }
  96.55% {
    background-position: tovmin(0) tovmin(-2366);
  }
  100.00% {
    background-position: tovmin(-421) tovmin(-2366);
  }
}
@keyframes right-rotate {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
@keyframes box-bg-animation {
  0% {
    background-position-x: 0;
  }
  100% {
    background-position-x: -2700%;
  }
}
@keyframes gather-guide-animation {
  0% {
    opacity: 0;
    margin-left: tovmin(100);
  }
  100% {
    opacity: 1;
    margin-left: 0;
  }
}
@keyframes gather-bar-animation {
  0% {
    visibility: visible;
    transform: scale(0.1, 0.1);
  }
  100% {
    visibility: visible;

    transform: scale(1, 1);
  }
}
@keyframes gather-yaya-animation {
  0% {
    margin-right: tovmin(200);
  }
  100% {
    margin-left: tovmin(83);
  }
}
@keyframes gather-yaya-flag {
  0% {
    background-position: tovmin(0) tovmin(0);
  }
  5.26% {
    background-position: tovmin(-280) tovmin(0);
  }
  10.53% {
    background-position: tovmin(-560) tovmin(0);
  }
  15.79% {
    background-position: tovmin(-840) tovmin(0);
  }
  21.05% {
    background-position: tovmin(-1120) tovmin(0);
  }
  26.32% {
    background-position: tovmin(-1400) tovmin(0);
  }
  31.58% {
    background-position: tovmin(-1680) tovmin(0);
  }
  36.84% {
    background-position: tovmin(0) tovmin(-360);
  }
  42.11% {
    background-position: tovmin(-280) tovmin(-360);
  }
  47.37% {
    background-position: tovmin(-560) tovmin(-360);
  }
  52.63% {
    background-position: tovmin(-840) tovmin(-360);
  }
  57.89% {
    background-position: tovmin(-1120) tovmin(-360);
  }
  63.16% {
    background-position: tovmin(-1400) tovmin(-360);
  }
  68.42% {
    background-position: tovmin(-1680) tovmin(-360);
  }
  73.68% {
    background-position: tovmin(0) tovmin(-720);
  }
  78.95% {
    background-position: tovmin(-280) tovmin(-720);
  }
  84.21% {
    background-position: tovmin(-560) tovmin(-720);
  }
  89.47% {
    background-position: tovmin(-840) tovmin(-720);
  }
  94.74% {
    background-position: tovmin(-1120) tovmin(-720);
  }
  100.00% {
    background-position: tovmin(-1400) tovmin(-720);
  }
}
</style>
