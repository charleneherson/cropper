<template>
    <view class="gold-box">
      <view :style="styleInfo" class="gold-count">
        <view class="content">
          <view class="icon" :class="{'showGoldIconFlash':isShowGoldIconFlash}"></view>
          <span class="number">{{ gold_count }}</span>
        </view>
        <view
          v-if="showGoldAnimation"
          :id="{'reach_top_coins': goldCount == 0}"
          class="animation"
          :class="[ {'normal': goldCount != 0}, {'limit': goldCount == 0}]" 
          :style="{ 'background-image': 'url(' + animationUrl + ')' }"
          @animationend="animationend" 
        >
        </view>
      </view>
    </view>
</template>
<script>
const animationMap = {
  1: 'https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/animation/1/images/1.png',
  2: 'https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/animation/2/images/2.png',
  3: 'https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/animation/3/images/3.png',
  5: 'https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/animation/5/images/5.png',
  6: 'https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/animation/6/images/6.png',
  7: 'https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/animation/7/images/7.png',
  8: 'https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/animation/8/images/8.png',
  9: 'https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/animation/9/images/9.png',
  0: 'https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/animation/%E5%B7%B2%E8%BE%BE%E4%B8%8A%E9%99%90/images/ydsx.png'
};
import { mapState, mapMutations } from "vuex";

export default {
  name: "yayaGold",
  components: {
  },
  props: {
    totalGoldCount: {
      type: Number,
      default: 0,
    },
  },
  computed: {
    ...mapState("yayaCommon", ["gold_count", "AWARD_EXT"]),
  },
  watch: {
    AWARD_EXT(val){
      console.log('反馈结束了反馈结束了反馈结束了反馈结束了')
      this.isShowGoldIconFlash = true;
      // 增加数字
      if(val.credit > 0) {
        this.goldCount = val.credit;
      } else {
        this.goldCount = 0;
      }
      this.animationUrl = animationMap[this.goldCount];
      setTimeout(()=>{
        this.isShowGoldIconFlash = false;
        this.showGoldAnimation = true;
        this.dirctorAudioContext.src = "https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-common/fankui/add_audio.mp3";
        this.dirctorAudioContext.play();
      },2500)
    }
  },
  data() {
    return {
      animationUrl:'',
      isShowGoldIconFlash: false, //展示结算
      goldCount: 0,
      showGoldAnimation: false,
      styleInfo: ''
    };
  },
  mounted() {
   this.updateGoldCount(this.totalGoldCount);
   const dd =wx.getMenuButtonBoundingClientRect();
   this.styleInfo = `height:${dd.height}px;top:${dd.top}px;`
   console.log('dddddddddddddddddddddddddddd');
   console.log(dd);
  },
  destroyed() {
  },
  methods: {
    ...mapMutations("yayaCommon", ["updateAwardExt","updateGoldCount","addGoldCount"]),
    animationend() {
      this.$emit('animationend');
      this.showGoldAnimation = false
      this.addGoldCount(this.AWARD_EXT.credit);
    }
  },
};
</script>
<style lang="scss" scoped>
@function toVmin($rpx) {
  @return #{$rpx * 100 / 750}vmin;
}
.gold-box{
  width: 100%;
  // height: toVmin(64);
  display: flex;
  justify-content: center;
  position: absolute;
  // top: toVmin(32);
  .gold-count {
    // width: toVmin(153);
    // height: toVmin(64);
    border-radius: toVmin(34);
    background: rgba(0,0,0,0.2);
    font-size: toVmin(36);
    font-family: DINCondensed-Bold,DINCondensed;
    font-weight: bold;
    color: rgba(255,255,255,1);
    margin-left: toVmin(670);
    position: relative;
    // position: absolute;
    // right: toVmin(240);
    z-index: 99;
  }
}
.content {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  position: relative;
  justify-content: space-between;
  padding: 0 toVmin(18);
  box-sizing: border-box;
  .icon {
    background-image: url('https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/animation/2/images/coin.png');
    width: toVmin(40);
    height: toVmin(40);
    background-size: toVmin(40) toVmin(40);
    margin-right: toVmin(8);
    &.showGoldIconFlash{
      animation: scale_s_b 2.6s steps(1) 1;
    }
  }
  .number{
    min-width: toVmin(40);
    font-family:DINAlternate-Bold;
    // height: toVmin(40);
    // line-height: toVmin(40);
  }
}

.normal {
  width: toVmin(140);
  height: toVmin(148);
	animation: animation1 1.07s steps(1) 1;
  position: absolute;
  top: toVmin(40);
  z-index: 1111;
  background-size: toVmin(1960) toVmin(296);
  left: toVmin(5);
}
.limit {
  width: toVmin(245);
	height: toVmin(148);
	position: absolute;
	animation: animation2 1.07s steps(1) 1;
  top: toVmin(40);
  z-index: 1111;
  background-size: toVmin(1960) toVmin(444);
  left: toVmin(-46);
}
.animation {
  position: absolute;
  top: toVmin(40);
}
@keyframes animation1 {
  0% { background-position: toVmin(0) toVmin(0); }
  6.25% { background-position: toVmin(-140) toVmin(0); }
  12.50% { background-position: toVmin(-280) toVmin(0); }
  18.75% { background-position: toVmin(-420) toVmin(0); }
  25.00% { background-position: toVmin(-560) toVmin(0); }
  31.25% { background-position: toVmin(-700) toVmin(0); }
  37.50% { background-position: toVmin(-840) toVmin(0); }
  43.75% { background-position: toVmin(-980) toVmin(0); }
  50.00% { background-position: toVmin(-1120) toVmin(0); }
  56.25% { background-position: toVmin(-1260) toVmin(0); }
  62.50% { background-position: toVmin(-1400) toVmin(0); }
  68.75% { background-position: toVmin(-1540) toVmin(0); }
  75.00% { background-position: toVmin(-1680) toVmin(0); }
  81.25% { background-position: toVmin(-1820) toVmin(0); }
  87.50% { background-position: toVmin(0) toVmin(-148); }
  93.75% { background-position: toVmin(-140) toVmin(-148); }
  100.00% { background-position: toVmin(-280) toVmin(-148); }
}
@keyframes animation2 {
	0% { background-position: toVmin(0) toVmin(0); }
	6.25% { background-position: toVmin(-245) toVmin(0); }
	12.50% { background-position: toVmin(-490) toVmin(0); }
	18.75% { background-position: toVmin(-735) toVmin(0); }
	25.00% { background-position: toVmin(-980) toVmin(0); }
	31.25% { background-position: toVmin(-1225) toVmin(0); }
	37.50% { background-position: toVmin(-1470) toVmin(0); }
	43.75% { background-position: toVmin(-1715) toVmin(0); }
	50.00% { background-position: toVmin(0) toVmin(-148); }
	56.25% { background-position: toVmin(-245) toVmin(-148); }
	62.50% { background-position: toVmin(-490) toVmin(-148); }
	68.75% { background-position: toVmin(-735) toVmin(-148); }
	75.00% { background-position: toVmin(-980) toVmin(-148); }
	81.25% { background-position: toVmin(-1225) toVmin(-148); }
	87.50% { background-position: toVmin(-1470) toVmin(-148); }
	93.75% { background-position: toVmin(-1715) toVmin(-148); }
	100.00% { background-position: toVmin(0) toVmin(-296); }
}
@keyframes scale_s_b {
  0%{
    transform: scale(1,1);
  }
  80%{
    transform: scale(1.2,1.2);
  }
  84%{
    transform: scale(1,1);
  }
  88%{
    transform: scale(1.2,1.2);
  }
  92%{
    transform: scale(1,1);
  }
  96%{
    transform: scale(1.2,1.2);
  }
  100%{
    transform: scale(1,1);
  }
}
</style>
