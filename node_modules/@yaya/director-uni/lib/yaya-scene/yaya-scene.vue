<template>
  <view class="scene">{{ scene && scene.raw && scene.raw.title }}</view>
</template>
<script>
import { director } from "../yaya-director/director";
export const SceneEventType = {
  Act: "act",
  Interact: "interact",
};

/**
 * 场景组件基类
 */
export default {
  name: "yayaScene",
  props: {
    raw: {
      type: Object,
      default: null,
    },
  },
  data() {
    return {
      scene: null,
      director: null,
      stayedTime: 0,
      isStart: false,
    };
  },
  mounted() {
    console.log("parent mounted");
    this.director = director;
    // 获取场景实例
    this.scene = director.getScene(this.raw.id);
    this.scene.onDestroy(() => {
      this.stop();
    });
  },
  beforeDestroy() {},
  destroyed() {},
  methods: {
    start() {
      this.isStart = true;
      this.stayedTime = +new Date();
    },
    stop() {
      this.stayedTime = +new Date() - this.stayedTime;
      this.isStart = false;
    },
    /**
     * 产生场景动作
     * 场景动作是场景间切换的描述
     */
    act(action) {
      console.log("Director act通知", action);
      this.$emit(SceneEventType.Act, action);
    },
    /**
     * 产生场景交互事件
     * 交互事件是场景内部产生的场景自定义的事件
     */
    interact(type, data) {
      let payload = {
        type,
        data,
      };
      console.log("场景interact通知", payload);
      this.$emit(SceneEventType.Interact, payload);
    },
  },
};
</script>
<style lang="scss" scoped>
.scene {
  width: 100vw;
  height: 100vh;
}
</style>
