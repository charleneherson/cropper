<template>
  <view 
    v-if="option.optionImage.url"
    :id="choose.length> 1 ? 'choice_img_single' :'choice_img_multiple'"
    :class="['option_border is_img',
      {'option_border_tip': isShowTips && !isShowRightIcon && choose.indexOf(optionName) > -1},
      {'short_two':optionsLength === 2},
      {'short_four':optionsLength === 4},
      {'short_six':optionsLength === 6},
      {'answer_wrong': !isShowRightIcon && isClick},
      {'title_image_two_audio':optionsLength === 2 && option.optionTitle && question.stems.audio && !question.stems.image},
      {'title_image_four_audio':optionsLength === 4 && option.optionTitle && question.stems.audio && !question.stems.title && !question.stems.image},
      {'title_image_four_audio_title':optionsLength === 4 && option.optionTitle && question.stems.audio && question.stems.title && !question.stems.image}
    ]"
    @click="chooseOption"
    >
    <image class="options_img" :src="option.optionImage.url" />
    <view class="options_title_audio" v-if="option.optionTitle && question.stems.audio && (!question.stems.title || question.stems.title && optionsLength === 2) && !question.stems.image">{{ option.optionTitle }}</view>
    <view class="options_title_audio_title" v-if="option.optionTitle && question.stems.audio && question.stems.title && !question.stems.image && optionsLength === 4">{{ option.optionTitle }}</view>
    <view :class="['choice_box',{'small_box':optionsLength === 6}]">
      <view v-if="(isShowRightIcon || allRightIcon) && choose.indexOf(optionName) > -1" :class="['choice_right',{'icon_small':optionsLength === 6},{'tight_flash':isShowRightIcon}]"></view>
      <!-- <view v-if="isShowTips && !isShowRightIcon && choose.indexOf(optionName) > -1" :class="['choice_right tips',{'icon_small':optionsLength === 6},{'tight_flash':isShowTips}]"></view> -->
    </view>
  </view>
  <view 
    v-else
    :id="choose.length> 1 ? 'choice_text_single' :'choice_text_multiple'"
    :class="['option_border',
      {'':optionsType === 'longText' && optionsLength === 2},
      {'option_border_tip': isShowTips && !isShowRightIcon && choose.indexOf(optionName) > -1}, 
      {'longtext_four':optionsType === 'longText' && optionsLength === 4},
      {'m_top':optionsType === 'longText' && optionsLength === 4 && (optionName == 'C' || optionName == 'D')},
      {'longtext_six':optionsType === 'longText' && optionsLength === 6},
      {'m_top':optionsType === 'longText' && optionsLength === 6 && (optionName == 'D' || optionName == 'E' || optionName == 'F')},
      {'short_two':optionsType === 'shortText' && optionsLength === 2},
      {'short_four':optionsType === 'shortText' && optionsLength === 4},
      {'short_six':optionsType === 'shortText' && optionsLength === 6},
      {'answer_wrong': !isShowRightIcon && isClick}
    ]"
    @click="chooseOption"
    >
      <view class="option_text">
        {{option.optionTitle}}
      </view>
      <view :class="['choice_box',{'small_box':optionsLength === 6}]">
        <view v-if="(isShowRightIcon || allRightIcon) && choose.indexOf(optionName) > -1" :class="['choice_right',{'icon_small':optionsLength === 6},{'tight_flash':isShowRightIcon}]"></view>
        <!-- <view v-if="isShowTips && !isShowRightIcon && choose.indexOf(optionName) > -1" :class="['choice_right tips',{'icon_small':optionsLength === 6},{'tight_flash':isShowTips}]"></view> -->
      </view>
  </view>
</template>
<script>
export default {
  name: "optionList",
  props: {
    option: {
      type: Object,
      default: () => {}
    },
    optionsLength: {
      type: Number,
      default: 0
    },
    optionsType: {
      type: String,
      default: ''
    },
    // 答案
    choose: {
      type: String,
      default: ''
    },
    optionName: {
      type: String,
      default: ''
    },
    // 提示
    isShowTips: {
      type: Boolean,
      default: false
    },
    // 选对
    allRightIcon: {
      type: Boolean,
      default: false
    },
    question: {
      type: Object,
      default: {}
    }
  },
  computed: {
    
  },
  data() {
    return {
      timer: null,
      innerAudioContext: null,
      isShowRightIcon: false,
      isClick: false,
    }
  },
  watch: {
    // 自动全对状态
    allRightIcon(val) {
      (val && this.choose.indexOf(this.optionName) > -1) && (this.isShowRightIcon = true)
    }
  },
  created() {
    this.innerAudioContext = wx.createInnerAudioContext();
  },
  methods: {
    chooseOption() {
      // 已选对不再往下走
      if(this.isShowRightIcon || this.allRightIcon) {return};
      this.isClick = true;
      if(this.choose.indexOf(this.optionName) > -1) {
        this.isShowRightIcon = true;
        // 答对传递出事件
        this.$emit("rightChoose",{chooseFlag:true,chooseKey:this.optionName});
      } else {
        this.isShowRightIcon = false;
        // 答错传递出事件
        this.$emit("rightChoose",{chooseFlag:false,chooseKey:this.optionName});
      }
      setTimeout(()=>{
        this.isClick = false;
      },1000)
    },
  },
  destroyed() {
  },
};
</script>
<style  lang="scss" scoped>
  @import "../../static/css/yaya-mixin.scss";
  .option_border{
    @include btn_common(429,100,36,#333333,rgba(2555,255,255,1),24);
    border: tovmin(9) solid #DBEFF7;
    position: relative;
    font-weight: 700;
    &.is_img{
      // background: #89C7F0;
      border: tovmin(9) solid #DBEFF7;
    }
    &.option_border_tip {
      border: tovmin(9) solid #FFA319;
      background: #FFA319;
      animation: breath 1s  infinite;
    }
    // &.option_border_right {
    //   border: tovmin(9) solid #BDF079;
    // }
    .option_text{
      background: #ffffff;
      border-radius: tovmin(24);
      font-weight: 700;
    }
    &.answer_wrong {
      animation: shake 1s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
      transform: translate3d(0, 0, 0);
      backface-visibility: hidden;
      perspective: 1000px;
    }

    &.longtext_four{
      width: tovmin(429);
    }
    &.longtext_six{
      width: tovmin(281);
    }
    &.short_two{
      @include v_w_h_center(222,220);
      margin-right: tovmin(26);
      font-size: tovmin(44);
    }
    &.short_four{
      @include v_w_h_center(193,193);
      font-size: tovmin(44);
    }
    &.short_six{
      @include v_w_h_center(126,126);
    }
    &.m_top{
      margin-top: tovmin(28);
    }
    .options_img{
      width: 100%;
      height: 100%;
      border-radius: tovmin(16);
      margin-top: tovmin(0);
      margin-right: tovmin(0);
      opacity: 1;
    }
    &.title_image_two_audio {
      @include v_w_h_center(230,326);
    }
    &.title_image_four_audio {
      @include v_w_h_center(230,326);
    }
    &.title_image_four_audio_title {
      @include v_w_h_center(192,272);
    }
    .choice_box{
      @include circle_view(68);
      position: absolute;
      right: 0;
      bottom: 0;
      transform: translate3d(30%,30%,0);
      text-align: center;
      &.small_box{
        transform: translate3d(60%,60%,0);
      }
      .choice_right{
        @include circle_view(68);
        background: url('https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-choice/right_icon_red.png') 100% 100%;
        background-size: auto 100%;
        z-index: 1;
        // &.tips{
        //   background: url('https://zyb-yayayuwen-1253445850.cos.ap-beijing.myqcloud.com/yaya-fe/sdk-media/yaya-choice/tip_icon_2.png') 100% 100%;
        //   background-size: contain;
        // }
        &.icon_small{
          @include circle_view(44);
        }
        &.tight_flash {
          animation: horn-animation 0.6s steps(2, end) 1;
        }
      }
    }
  }
  .title_image_two_audio .options_img {
    width: tovmin(230);
    height: tovmin(230);
    border-radius: tovmin(16) tovmin(16) 0 0;
  }
  .title_image_four_audio .options_img {
    width: tovmin(230);
    height: tovmin(230);
    border-radius: tovmin(16) tovmin(16) 0 0;
  }
  .title_image_four_audio_title .options_img {
    width: tovmin(192);
    height: tovmin(192);
    border-radius: tovmin(16) tovmin(16) 0 0;
  }
  .options_title_audio {
    width: tovmin(230);
    height: tovmin(96);
    line-height: tovmin(96);
    text-align: center;
    font-weight: 700;
    font-size: tovmin(34);
    font-family: PingFangSC-Medium,PingFang SC;
    color: rgba(51,51,51,1);
    position: absolute;
    left: tovmin(0);
    bottom: tovmin(0);
    background: #fff;
    border-radius: 0 0 tovmin(16) tovmin(16);
  }
  .options_title_audio_title {
    width: tovmin(192);
    height: tovmin(80);
    line-height: tovmin(80);
    font-weight: 700;
    text-align: center;
    font-size: tovmin(28);
    font-family: PingFangSC-Medium,PingFang SC;
    color: rgba(51,51,51,1);
    position: absolute;
    left: tovmin(0);
    bottom: tovmin(0);
    background: #fff;
    border-radius: 0 0 tovmin(16) tovmin(16);
  }
  @keyframes shake {
    10%,
    90% {
      transform: translate3d(-2px, 0, 0);
    }

    20%,
    80% {
      transform: translate3d(4px, 0, 0);
    }

    30%,
    50%,
    70% {
      transform: translate3d(-8px, 0, 0);
    }

    40%,
    60% {
      transform: translate3d(8px, 0, 0);
    }
  }
  @keyframes horn-animation {
    0% {
      transform: scale(.1,.1);
    }
    25% {
      transform: scale(.6,.6);
    }
    50% {
      transform: scale(1.2,1.2);
    }
    75% {
      transform: scale(1.1,1.1);
    }
    100% {
      transform: scale(1,1);
    }
  }
  @keyframes breath {
    0% {
      border: tovmin(9) solid rgba(255,163,25,1);
      background: rgba(255,163,25,1);
    }

    50% {
      border: tovmin(9) solid #DBEFF7;
      background: #DBEFF7;
    }
    100% {
      border: tovmin(9) solid rgba(255,163,25,0);
      background: rgba(255,163,25,1);
    }
  }
</style>