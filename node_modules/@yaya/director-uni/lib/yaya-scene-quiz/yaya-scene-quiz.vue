<template>
  <view class="scene">
    <!-- 场景内的布局组织自定义： -->
    <view>{{ scene && scene.raw && scene.raw.title }}</view>
    <swiper
      class="swiper"
      :indicator-dots="true"
      :autoplay="false"
      :current="currentQuestion"
    >
      <swiper-item
        v-for="question in scene.data.ext.questionList"
        :key="question.tid"
      >
        <view class="swiper-item uni-bg-red">
          {{ question.content }}
          <view class="question-answers">
            <button type="primary" @click="doRight">答对</button>
            <button type="warn" @click="doWrong">答错</button>
            <button type="primary" @click="startRecord">模拟录音</button> </view
          >全部答对进入场景3，任意答错进入场景4
        </view>
      </swiper-item>
    </swiper>
  </view>
</template>
<script>
import yayaScene from "../yaya-scene/yaya-scene.vue";
export default {
  name: "yayaSceneQuiz",
  // 扩展场景基类（vue的extends好菜，vue+uniapp+mp）
  extends: yayaScene,
  props: {},
  data() {
    return {
      currentQuestion: 0,
      correctCount: 0,
    };
  },
  methods: {
    startRecord() {
      // 假装调用录音
      // recorder.record().then(res => {
      setTimeout(() => {
        // 录音完成，抛出一个自定义的交互事件
        this.interact("anwsered", {
          // audio: res.url,
          // audioLength: res.length
          audio: "https://box.zuoyebang.cc/abc/1.mp3",
          duration: 2334,
        });
      }, 1000);
      // });
    },
    doRight() {
      let scene = this.scene;
      this.correctCount++;
      if (this.correctCount === scene.data.ext.questionList.length) {
        // 产生场景动作
        this.act(scene.actions.success);
        return;
      }
      this.currentQuestion++;
    },
    doWrong() {
      let scene = this.scene;
      // 如果有场景动作，进行场景切换
      if (scene.actions.fail) {
        // 产生场景动作
        this.act(scene.actions.fail);
      } else {
        // 其他回答错误逻辑
        console.log("答错了～");
      }
    },
  },
};
</script>
<style lang="scss" scoped>
.scene {
  width: 60vw;
  height: 60vh;
  border: 1px solid black;
  background-color: #89cce5;
}
.swiper {
  height: 90%;
}
.swiper-item {
  padding: 10px 10px 40px 10px;
}
.question-answers {
  button {
    margin: 10px;
  }
}
</style>
