import { hybrid } from '../../../utils/iframeHybrid'
import Type from '../../../utils/type'
import {getIframePromiseFunc} from '../../../utils/tool'

/**
 *http://qatest7.suanshubang.com/static/fe-docs/_book/hybrid-sdk/app_userinfo.html
 *
 */

/**
 *获取位置信息
 * @export
 * @param {Function} callback
 * @returns {object}
 *  @property {string} province 省
 *  @property {string} city     市
 */
export function getLocation (callback?: Function) {
  if (Type.isFunction(callback)) {
    console.error('callback is not a function')
    return false
  };

  let success= function(res: any){
    callback && callback(res);
    return res;
  };
  let fail= success;
  return getIframePromiseFunc("getLocation").then(success, fail);
}

/**
 *获取用户信息
 * @export
 * @param {Function} callback
 * @returns {object}
 *  @property {string} uid         用户uid
 *  @property {string} uname        姓名
 *  @property {string} bindPhone    姓名
 *  @property {string} schoolCid
 *  @property {string} schoolName
 *  @property {string} gradeId
 *  @property {string} gradeTxt
 */
export function getUserinfo (callback?: Function) {
  if (!Type.isFunction(callback)) {
    console.error('getuserinfo callback is not a function')
    return false
  }
  let success= function(res: any){
    callback && callback(res);
    return Promise.resolve(res);
  };
  let fail= function(res: any){
    callback && callback(res);
    return Promise.reject(res);
  };
  return getIframePromiseFunc("getuserinfo").then(success, fail);
  // ios action not fount
  // {
  //   errcode: 404,
  //   errmsg: "sdfsdf"
  // }

  // android action not fount
  // {
  //   "code": 200,
  //   "data": {
  //     callResult: false
  //   }
  // }
}

/**
 * FE通知app保存收货地址成功和失败
 * @param {Object} options
 *  @property {String} total_address         地址
 *  @property {String} user_name             用户名
 *  @property {String} phone_number          手机号
 *  @property {Boolean} beforeOrAfterSuccess  0:显示保存中的toast,250ms后关闭,1:直接关闭页面
 */
export function interceptSaveAddress (options = {}) {
  if (!options) {
    console.error('parameter is undefined!')
    return false
  }
  hybrid('afterSaveAddressAction', options)
}
